services:

  # API Gateway - Main orchestration service
  api-gateway:
    build:
      context: ./
      dockerfile: api/Dockerfile
    ports:
      - "8000:8000"
    environment:
      POSTGRES_USER: user
      POSTGRES_DB: ome_hackathon
      POSTGRES_PASSWORD: ilovedataforgood
      POSTGRES_HOST: postgres
      POSTGRES_PORT: 5432
      SENTIMENT_SERVICE_URL: http://sentiment-service:8001
      NER_SERVICE_URL: http://ner-service:8002
      KEYWORDS_SERVICE_URL: http://keywords-service:8003
    depends_on:
      - postgres
      - sentiment-service
      - ner-service
      - keywords-service
    networks:
      - metanet1
    volumes:
      - "./data:/app/data:ro"

  # Sentiment Analysis Microservice
  sentiment-service:
    build:
      context: ./
      dockerfile: sentiment/Dockerfile
    expose:
      - "8001"
    networks:
      - metanet1

  # NER Microservice
  ner-service:
    build:
      context: ./
      dockerfile: ner/Dockerfile
    expose:
      - "8002"
    networks:
      - metanet1

  # Keywords Extraction Microservice
  keywords-service:
    build:
      context: ./
      dockerfile: key-words/Dockerfile
    expose:
      - "8003"
    networks:
      - metanet1
    
  postgres:
    image: postgres:15
    ports:
      - 5432:5432
    volumes:
      - './pgdata:/var/lib/postgresql/data' 
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U user -d ome_hackathon"]
      interval: 5s
      timeout: 5s
      retries: 5
    environment:
      TZ: Europe/Paris
      POSTGRES_USER: user
      POSTGRES_DB: ome_hackathon
      POSTGRES_PASSWORD: ilovedataforgood
    logging: # 
      driver: none
    networks:
      - metanet1


networks:
  metanet1:
    driver: bridge
